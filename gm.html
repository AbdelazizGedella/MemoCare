<!DOCTYPE html>
<html lang="en" dir="ltr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ER ON-DUTY REPORT</title>

  <!-- Tailwind + DaisyUI + Icons + Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root { --glass-bg: rgba(255,255,255,0.06); --glass-bd: rgba(255,255,255,0.15); }
    body { font-family: 'Cairo', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .glass {
      background: var(--glass-bg);
      border: 1px solid var(--glass-bd);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="min-h-screen bg-[#070E2A] text-white">
  <!-- Top Bar -->
  <header class="sticky top-0 z-50 bg-gradient-to-r from-[#0E2CFF] via-[#2653F6] to-[#0E2CFF] shadow-md">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-lg sm:text-2xl font-bold tracking-wide">ER ON-DUTY REPORT</h1>
      <div class="hidden sm:flex items-center gap-2 text-xs opacity-90">
        <i class="fa-solid fa-shield-heart"></i>
        <span>Quick-notify toolkit</span>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-3 sm:px-4 md:px-6 py-6">
    <!-- Form Switcher -->
    <nav class="glass rounded-2xl p-2 mb-5 overflow-x-auto no-scrollbar">
      <div id="formTabs" class="flex gap-2 min-w-max">

        <button class="tab tab-active rounded-xl px-4 py-2 bg-gradient-to-br from-cyan-600 to-cyan-900 text-white" data-form="transfer">
          <i class="fa-solid fa-ambulance mr-2"></i>Transfer Outside
        </button>

        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-red-600 to-red-900 text-white" data-form="death">
          <i class="fa-solid fa-heart-circle-xmark mr-2"></i>Death
        </button>

        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-purple-600 to-purple-900 text-white" data-form="code">
          <i class="fa-solid fa-bell mr-2"></i>Code
        </button>

        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-yellow-600 to-yellow-900 text-white" data-form="power">
          <i class="fa-solid fa-bolt mr-2"></i>Power / Fire
        </button>

        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-pink-600 to-pink-900 text-white" data-form="issue">
          <i class="fa-solid fa-triangle-exclamation mr-2"></i>Significant Issue
        </button>

        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-emerald-600 to-emerald-900 text-white" data-form="admission">
          <i class="fa-solid fa-notes-medical mr-2"></i>Admission / Internal
        </button>

        <!-- NEW: TRIAGE REPORT TAB -->
        <button class="tab rounded-xl px-4 py-2 bg-gradient-to-br from-sky-600 to-sky-900 text-white" data-form="triage">
          <i class="fa-solid fa-clipboard-list mr-2"></i>Triage Report
        </button>

      </div>
    </nav>

    <!-- FORMS CONTAINER -->
    <section id="forms" class="space-y-6">

      <!-- TRANSFER OUTSIDE (ER) -->
      <div id="form_transfer" class="glass rounded-2xl p-5">
        <h2 class="text-xl font-bold text-cyan-300 mb-4">*[ER | Transfer Outside Notification]*</h2>
        <p class="text-xs text-white/70 text-center mb-4">To be Send on CMH Nursing On-Duty Group Only</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control"><span class="label-text">Patient Name</span><input id="t_name" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRN</span><input id="t_mrn" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Date & Time</span><input id="t_datetime" type="datetime-local" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Payer</span>
            <select id="t_payer" class="select select-bordered bg-[#0f172a]">
              <option value="">Select Payer</option><option>MOH</option><option>TCS</option><option>CASH</option><option>Other</option>
            </select>
          </label>
          <label class="form-control"><span class="label-text">Room</span><input id="t_room" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Physician</span><input id="t_doc" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Nurse</span><input id="t_nurse" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Transferred To</span><input id="t_to" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Diagnosis</span><input id="t_dx" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-cyan-600" onclick="generateTransfer()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_transfer')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_transfer')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_transfer" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- DEATH NOTIFICATION -->
      <div id="form_death" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-red-300 mb-4">*[ER | Death Notification]*</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control"><span class="label-text">Patient Name</span><input id="d_name" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRN</span><input id="d_mrn" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Time of Death</span><input id="d_datetime" type="datetime-local" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Physician</span><input id="d_doc" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Nurse</span><input id="d_nurse" class="input input-bordered bg-[#0f172a]"/></label>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-red-600" onclick="generateDeath()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_death')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_death')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_death" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- CODE ACTIVATION -->
      <div id="form_code" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-purple-300 mb-4">*[ER | Code Notification]*</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control md:col-span-1"><span class="label-text">Code Type</span>
            <select id="c_type" class="select select-bordered bg-[#0f172a]">
              <option value="">Select Code Type</option>
              <option>Code Blue</option>
              <option>Code Yellow</option>
              <option>Fire Alarm</option>
            </select>
          </label>
          <label class="form-control md:col-span-1"><span class="label-text">Location</span><input id="c_location" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Date & Time</span><input id="c_datetime" type="datetime-local" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <!-- Ÿäÿ∏Ÿáÿ± ŸÅŸÇÿ∑ ŸÖÿπ Code Blue -->
        <div id="code_extras" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 hidden">
          <label class="form-control md:col-span-1">
            <span class="label-text">Patient Name</span>
            <input id="c_pname" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">MRN</span>
            <input id="c_mrn" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">INITIAL RHYTHM</span>
            <input id="i_ryth" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">AGE</span>
            <input id="age1" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">NATIONALITY</span>
            <input id="nat1" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">Output of Code</span>
            <select id="c_output" class="select select-bordered bg-[#0f172a]">
              <option value="">Select Outcome</option>
              <option>Transferred Outside for .........</option>
              <option>Death</option>
              <option>Transferred to ICU</option>
              <option>Other</option>
            </select>
          </label>

          <label class="form-control md:col-span-1">
            <span class="label-text">Disposition</span>
            <input id="c_disposition" class="input input-bordered bg-[#0f172a]" placeholder="ICU / Ward / Home / Morgue / Other" />
          </label>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-purple-600" onclick="generateCode()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_code')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_code')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_code" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- POWER / FIRE ALARM -->
      <div id="form_power" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-yellow-300 mb-4">Power / Fire Alarm</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control md:col-span-1"><span class="label-text">Location</span><input id="p_location" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Date & Time</span><input id="p_datetime" type="datetime-local" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-2"><span class="label-text">Description</span><input id="p_note" class="input input-bordered bg-[#0f172a]" placeholder="Short description..."/></label>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-yellow-500" onclick="generatePower()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_power')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_power')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_power" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- SIGNIFICANT ISSUE -->
      <div id="form_issue" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-pink-300 mb-4">Significant Issue</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control md:col-span-1"><span class="label-text">Reported By</span><input id="i_reporter" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Location</span><input id="i_location" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-2"><span class="label-text">Issue Description</span><input id="i_issue" class="input input-bordered bg-[#0f172a]" placeholder="What happened?"/></label>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-pink-600" onclick="generateIssue()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_issue')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_issue')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_issue" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- ICU BOARDING CASE -->
      <div id="form_icu" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-blue-300 mb-2 text-center">üìù ICU Boarding Case Kpi</h2>
        <p class="text-xs text-white/70 text-center mb-4">To be Send on [CMH | ER] Charge Nurses Group Only</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <label class="form-control"><span class="label-text">Hospital File Number (ÿ±ŸÇŸÖ ŸÖŸÑŸÅ ÿßŸÑŸÖÿ±Ÿäÿ∂)</span><input id="icu_file" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Patient Name (ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ±Ÿäÿ∂)</span><input id="icu_name" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <h3 class="text-blue-300 font-semibold mb-2">üöë Emergency & Transfer Info</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <label class="form-control"><span class="label-text">ER Registration Date (ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶)</span><input id="icu_er_date" type="date" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">ER Registration Time (ŸàŸÇÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶)</span><input id="icu_er_time" type="time" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Internal Transfer Date (ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿØÿßÿÆŸÑŸä)</span><input id="icu_transfer_date" type="date" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Hospital Departure Time (ŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿ¥ŸÅŸâ)</span><input id="icu_departure_time" type="time" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <h3 class="text-blue-300 font-semibold mb-2">üìû Consultation Timing</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <label class="form-control"><span class="label-text">Consultation Request Time</span><input id="icu_consult_time" type="time" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Consultation Response Time</span><input id="icu_response_time" type="time" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <h3 class="text-blue-300 font-semibold mb-2">üè• Second Department Info</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <label class="form-control"><span class="label-text">Admission Date (ŸÇÿ≥ŸÖ ÿ´ÿßŸÜŸä)</span><input id="icu_second_admit_date" type="date" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Admission Time (ŸÇÿ≥ŸÖ ÿ´ÿßŸÜŸä)</span><input id="icu_second_admit_time" type="time" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Receiving Department</span><input id="icu_receiving" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Referring Physician</span><input id="icu_physician" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Nursing (Our Department)</span><input id="icu_nurse" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Reception (ŸÖŸàÿ∏ŸÅ ÿßŸÑÿ•ÿ≥ÿ™ŸÇÿ®ÿßŸÑ)</span><input id="icu_reception" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Second Dept Physician</span><input id="icu_second_doc" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Second Dept Nursing</span><input id="icu_second_nurse" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-2"><span class="label-text">Reason for Transfer</span><input id="icu_reason" class="input input-bordered bg-[#0f172a]"/></label>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-blue-600" onclick="generateICU()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_icu')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_icu')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_icu" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- ADMISSION / INTERNAL TRANSFER FORM -->
      <div id="form_admission" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-emerald-300 mb-4">Admission / Transfer (Internal)</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control"><span class="label-text">Patient Name</span><input id="a_name" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRN</span><input id="a_mrn" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Date & Time</span><input id="a_datetime" type="datetime-local" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-1"><span class="label-text">Payer</span>
            <select id="a_payer" class="select select-bordered bg-[#0f172a]">
              <option value="">Select Payer</option><option>MOH</option><option>TCS</option><option>CASH</option><option>Other</option>
            </select>
          </label>
          <label class="form-control"><span class="label-text">Room / Bed</span><input id="a_room" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Physician</span><input id="a_mrpDoc" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">MRP Nurse</span><input id="a_mrpNurse" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Transferred To (optional)</span><input id="a_transferTo" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Discharge To (optional)</span><input id="a_dischargeTo" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control"><span class="label-text">Admitted To (optional)</span><input id="a_admittedTo" class="input input-bordered bg-[#0f172a]"/></label>
          <label class="form-control md:col-span-2"><span class="label-text">Diagnosis</span><input id="a_diagnosis" class="input input-bordered bg-[#0f172a]"/></label>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-emerald-600" onclick="generateAdmission()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_admission')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_admission')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>
        <pre id="output_admission" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

      <!-- NEW: TRIAGE REPORT -->
      <div id="form_triage" class="glass rounded-2xl p-5 hidden">
        <h2 class="text-xl font-bold text-sky-300 mb-2">*[Triage Report]*</h2>
        <p class="text-xs text-white/70 text-center mb-4">Quick triage summary for on-duty reporting</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="form-control md:col-span-2">
            <span class="label-text">Date</span>
            <input id="tr_date" type="date" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control">
            <span class="label-text">Period From</span>
            <input id="tr_from" type="time" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control">
            <span class="label-text">Period To</span>
            <input id="tr_to" type="time" class="input input-bordered bg-[#0f172a]" />
          </label>

          <label class="form-control">
            <span class="label-text">SRCA Not Registered</span>
            <input id="tr_srca_nr" type="number" min="0" class="input input-bordered bg-[#0f172a]" placeholder="0" />
          </label>

          <label class="form-control">
            <span class="label-text">Self Not Registered</span>
            <input id="tr_self_nr" type="number" min="0" class="input input-bordered bg-[#0f172a]" placeholder="0" />
          </label>

          <label class="form-control">
            <span class="label-text">Total Registered Cases</span>
            <input id="tr_total_reg" type="number" min="0" class="input input-bordered bg-[#0f172a]" placeholder="0" />
          </label>

          <label class="form-control">
            <span class="label-text">ECG for Chest Pain Pts</span>
            <input id="tr_ecg_cp" type="number" min="0" class="input input-bordered bg-[#0f172a]" placeholder="0" />
          </label>

          <label class="form-control md:col-span-2">
            <span class="label-text">CTAS Change Count</span>
            <input id="tr_ctas_change" type="number" min="0" class="input input-bordered bg-[#0f172a]" placeholder="0" />
          </label>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-2">
          <button class="btn bg-sky-600 text-white" onclick="generateTriageReport()"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Generate</button>
          <button class="btn bg-green-600 text-white" onclick="copyToWhatsapp('output_triage')"><i class="fab fa-whatsapp mr-2"></i>Copy & WhatsApp</button>
          <button class="btn btn-ghost" onclick="clearForm('form_triage')"><i class="fa-regular fa-trash-can mr-2"></i>Clear</button>
        </div>

        <pre id="output_triage" class="hidden mt-3 bg-[#0b122e] rounded-xl p-4 text-sm whitespace-pre-wrap"></pre>
      </div>

    </section>
  </main>

  <!-- SCRIPTS -->
  <script>
    // ---- Tabs / Forms Switch
    const formsOrder = ['transfer','death','code','power','issue','icu','admission','triage'];
    const tabs = document.querySelectorAll('#formTabs .tab');

    tabs.forEach(btn => {
      btn.addEventListener('click', () => showForm(btn.dataset.form));
    });

    function showForm(type){
      // toggle tab active
      tabs.forEach(b => b.classList.remove('tab-active'));
      document.querySelector(`[data-form="${type}"]`)?.classList.add('tab-active');

      // toggle forms
      formsOrder.forEach(id => document.getElementById('form_'+id)?.classList.add('hidden'));
      document.getElementById('form_'+type)?.classList.remove('hidden');

      // optional defaults
      if(type === 'triage') setTriageDefaultDate();

      // focus first input if possible
      const firstInput = document.querySelector('#form_'+type+' input, #form_'+type+' select');
      firstInput && firstInput.focus();
    }

    // default
    showForm('transfer');

    // ---- Code extras toggle
    const ctype = document.getElementById('c_type');
    ctype?.addEventListener('change', toggleCodeExtras);

    function toggleCodeExtras(){
      const ex = document.getElementById('code_extras');
      if(!ex) return;
      (ctype.value === 'Code Blue') ? ex.classList.remove('hidden') : ex.classList.add('hidden');
    }
    toggleCodeExtras();

    // ---- Helpers
    function line(label, value){ return `\`${label}\` : *${value ?? ''}*\n`; }

    function copyToWhatsapp(outputId){
      const text = document.getElementById(outputId)?.innerText.trim();
      if(!text){ alert('‚õî No message generated.'); return; }
      navigator.clipboard.writeText(text).then(() => {
        const url = 'https://wa.me/?text=' + encodeURIComponent(text);
        window.open(url, '_blank');
      });
    }

    function clearForm(formId){
      const form = document.getElementById(formId);
      form?.querySelectorAll('input').forEach(el => { el.value = ''; });
      form?.querySelectorAll('select').forEach(el => { el.value = ''; });

      const pre = form?.querySelector('pre');
      if(pre){
        pre.classList.add('hidden');
        pre.innerText = '';
      }

      // keep code extras in correct state
      if(formId === 'form_code') toggleCodeExtras();
      if(formId === 'form_triage') setTriageDefaultDate();
    }

    // ---- Generators
    function generateTransfer(){
      const msg = `**Transfer Outside Notification From ER**\n\n` +
        line('Patient Name', t_name.value) +
        line('MRN', t_mrn.value) +
        line('Date & Time', t_datetime.value) +
        line('Payer', t_payer.value) +
        line('Room', t_room.value) +
        line('MRP Physician', t_doc.value) +
        line('MRP Nurse', t_nurse.value) +
        line('Transferred To', t_to.value) +
        line('Diagnosis', t_dx.value);

      output_transfer.innerText = msg; output_transfer.classList.remove('hidden');
    }

    function generateDeath(){
      const msg = `**Death Notification**\n\n` +
        line('Patient Name', d_name.value) +
        line('MRN', d_mrn.value) +
        line('Time of Death', d_datetime.value) +
        line('MRP Physician', d_doc.value) +
        line('MRP Nurse', d_nurse.value);

      output_death.innerText = msg; output_death.classList.remove('hidden');
    }

    function generateCode(){
      let msg = `**Code Activation Report**\n\n` +
        line('Code Type', c_type.value) +
        line('Location', c_location.value) +
        line('Date & Time', c_datetime.value);

      if (c_type.value === 'Code Blue') {
        msg +=
          line('Patient Name', c_pname.value) +
          line('MRN', c_mrn.value) +
          line('Output of Code', c_output.value) +
          line('Disposition', c_disposition.value) +
          line('Initial Rhythm', i_ryth.value) +
          line('Age', age1.value) +
          line('Nationality', nat1.value);
      }

      output_code.innerText = msg;
      output_code.classList.remove('hidden');
    }

    function generatePower(){
      const msg = `**Power Outage / Fire Alarm**\n\n` +
        line('Location', p_location.value) +
        line('Date & Time', p_datetime.value) +
        line('Description', p_note.value);

      output_power.innerText = msg; output_power.classList.remove('hidden');
    }

    function generateIssue(){
      const msg = `**Significant Issue Reported**\n\n` +
        line('Reported By', i_reporter.value) +
        line('Location', i_location.value) +
        line('Issue', i_issue.value);

      output_issue.innerText = msg; output_issue.classList.remove('hidden');
    }

    function generateICU(){
      const fields = [
        { label: 'Hospital File Number', id: 'icu_file' },
        { label: 'Patient Name', id: 'icu_name' },
        { label: 'ER Registration Date', id: 'icu_er_date' },
        { label: 'ER Registration Time', id: 'icu_er_time' },
        { label: 'Internal Transfer Date', id: 'icu_transfer_date' },
        { label: 'Hospital Departure Time', id: 'icu_departure_time' },
        { label: 'Consultation Request Time', id: 'icu_consult_time' },
        { label: 'Consultation Response Time', id: 'icu_response_time' },
        { label: 'Second Dept Admission Date', id: 'icu_second_admit_date' },
        { label: 'Second Dept Admission Time', id: 'icu_second_admit_time' },
        { label: 'Receiving Department', id: 'icu_receiving' },
        { label: 'Referring Physician', id: 'icu_physician' },
        { label: 'Nursing (Our Dept)', id: 'icu_nurse' },
        { label: 'Reception (Second Dept)', id: 'icu_reception' },
        { label: 'Second Dept Physician', id: 'icu_second_doc' },
        { label: 'Second Dept Nursing', id: 'icu_second_nurse' },
        { label: 'Reason for Transfer', id: 'icu_reason' }
      ];

      let msg = 'üìù *ICU Boarding Case Template*\n\n';
      fields.forEach(f => {
        const v = document.getElementById(f.id)?.value || '';
        msg += line(f.label, v);
      });

      output_icu.innerText = msg; output_icu.classList.remove('hidden');
    }

    function generateAdmission(){
      const msg = `**Admission Notification**\n\n` +
        line('Patient Name', a_name.value) +
        line('MRN', a_mrn.value) +
        line('Date & Time', a_datetime.value) +
        line('Payer', a_payer.value) +
        line('Room / Bed', a_room.value) +
        line('MRP Physician', a_mrpDoc.value) +
        line('MRP Nurse', a_mrpNurse.value) +
        (a_transferTo.value ? line('Transferred To', a_transferTo.value) : '') +
        (a_dischargeTo.value ? line('Discharge To', a_dischargeTo.value) : '') +
        (a_admittedTo.value ? line('Admitted To', a_admittedTo.value) : '') +
        line('Diagnosis', a_diagnosis.value);

      output_admission.innerText = msg; output_admission.classList.remove('hidden');
    }

    // ---- NEW: TRIAGE REPORT
    function setTriageDefaultDate(){
      const el = document.getElementById('tr_date');
      if(!el) return;
      if(el.value) return;
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      el.value = `${yyyy}-${mm}-${dd}`;
    }

    function generateTriageReport(){
      setTriageDefaultDate();

      const date = tr_date.value || '';
      const from = tr_from.value || '';
      const to   = tr_to.value || '';

      const msg =
        `*TRIAGE REPORT*\n\n` +
        line('Date', date) +
        line('Period', (from && to) ? `${from} ‚Üí ${to}` : '') +
        `\n` +
        line('SRCA Not Registered', tr_srca_nr.value || 0) +
        line('Self Not Registered', tr_self_nr.value || 0) +
        line('Total Registered Cases', tr_total_reg.value || 0) +
        line('ECG for Chest Pain Pts', tr_ecg_cp.value || 0) +
        line('CTAS Change Count', tr_ctas_change.value || 0);

      output_triage.innerText = msg;
      output_triage.classList.remove('hidden');
    }
  </script>
</body>
</html>
