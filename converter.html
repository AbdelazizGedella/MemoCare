<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XLS ‚ûú XLSX Converter ‚Äî MemoCare Tools</title>

  <!-- SheetJS (XLS/XLSX in the browser) -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#0b1e3b; --card:#0f274b; --muted:#94a3b8; --acc:#22d3ee; --acc2:#06b6d4; --ok:#10b981; --warn:#f59e0b; --err:#ef4444;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,Arial; background:var(--bg); color:#e5eefc}
    .wrap{max-width:900px; margin:40px auto; padding:0 16px}
    .title{font-size:clamp(22px,3vw,30px); font-weight:700; letter-spacing:.3px; margin:0 0 14px}
    .subtitle{color:var(--muted); margin:0 0 24px}
    .card{background:linear-gradient(180deg, rgba(34,211,238,0.08), transparent 120%), var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .row{display:flex; gap:14px; flex-wrap:wrap}
    .pad{padding:18px}
    .zone{flex:1 1 380px; padding:18px; border:2px dashed rgba(255,255,255,.18); border-radius:var(--radius);
      background:rgba(255,255,255,.02); text-align:center; transition:.2s ease; outline:none}
    .zone:hover{border-color:var(--acc); background:rgba(34,211,238,.06)}
    .zone.dragover{border-color:var(--acc2); background:rgba(6,182,212,.10)}
    .zone h3{margin:6px 0 10px; font-size:18px}
    .zone p{margin:0; color:var(--muted); font-size:14px}
    input[type=file]{display:none}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(135deg, #1b355f, #163056); color:#e8f7ff; cursor:pointer; font-weight:600; transition:.2s}
    .btn:hover{transform:translateY(-1px); box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .ghost{border-color:transparent; background:transparent}
    .actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:12px}
    .list{max-height:280px; overflow:auto; border-top:1px solid rgba(255,255,255,.06); margin-top:14px}
    .item{display:grid; grid-template-columns: 1fr auto auto; align-items:center; gap:10px; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.06)}
    .name{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12); color:#cfe9ff}
    .ok{color:#caffea; border-color:rgba(16,185,129,.45)}
    .warn{color:#fff2cf; border-color:rgba(245,158,11,.45)}
    .err{color:#ffd5d5; border-color:rgba(239,68,68,.45)}
    .small{font-size:12px; color:var(--muted)}
    .footer{margin-top:20px; color:var(--muted); font-size:13px}
    .hint{color:#9be6ff}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; background:#0b203f; border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">XLS ‚ûú XLSX Converter</h1>
    <p class="subtitle">Drop your <strong>.xls</strong> files or choose them ‚Äî the page will convert each to <strong>.xlsx</strong> and auto-download.</p>

    <div class="card pad">
      <div class="row">
        <label class="zone" id="dropzone" tabindex="0" aria-label="Drop XLS files here">
          <h3>üìÇ Drag & Drop</h3>
          <p>Drop <strong>.xls</strong> files here, or</p>
          <div class="actions" style="justify-content:center; margin-top:12px;">
            <label class="btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 16V4m0 12l-3.5-3.5M12 16l3.5-3.5M4 20h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Choose Files
              <input id="fileInput" type="file" accept=".xls" multiple />
            </label>
            <button class="btn ghost" id="clearList" type="button">Clear List</button>
          </div>
          <p class="small" style="margin-top:10px">Tip: You can also press <span class="kbd">Enter</span> to open the file picker.</p>
        </label>

        <div class="zone" style="text-align:left">
          <h3>‚öôÔ∏è Options</h3>
          <label class="small"><input id="keepNames" type="checkbox" checked /> Keep original file names</label><br/>
          <label class="small"><input id="autoDownload" type="checkbox" checked /> Auto-download after conversion</label><br/>
          <label class="small"><input id="openAfter" type="checkbox" /> Try to open file after download (browser-controlled)</label>
          <div class="actions">
            <button class="btn" id="convertBtn" type="button" aria-label="Convert all queued files">
              üîÅ Convert All
            </button>
          </div>
          <p class="small" style="margin-top:8px">
            Notes: Old <em>.xls</em> (BIFF8) is supported. Features unsupported by <span class="hint">XLSX</span> may be adjusted by the library.
          </p>
        </div>
      </div>

      <div class="list" id="fileList" aria-live="polite" aria-label="Selected files list"></div>
      <div class="footer">Built with <span class="hint">SheetJS</span>. ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑŸÑÿÆÿßÿØŸÖ ‚Äî ŸÉŸÑ ÿ¥Ÿäÿ° Ÿäÿ™ŸÖ ŸÖÿ≠ŸÑŸäŸãÿß ŸÅŸä ÿßŸÑŸÖÿ™ÿµŸÅÿ≠.</div>
    </div>
  </div>

  <script>

      (function ensureXLSX(){
    if (window.XLSX) return;
    var alt = document.createElement('script');
    alt.src = 'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js';
    alt.onload = function(){ console.log('Loaded XLSX from fallback.'); };
    alt.onerror = function(){ console.error('Failed to load XLSX from fallback CDN.'); };
    document.head.appendChild(alt);
  })();

  
    const fileInput   = document.getElementById('fileInput');
    const dropzone    = document.getElementById('dropzone');
    const fileListEl  = document.getElementById('fileList');
    const convertBtn  = document.getElementById('convertBtn');
    const clearBtn    = document.getElementById('clearList');
    const keepNames   = document.getElementById('keepNames');
    const autoDownload= document.getElementById('autoDownload');
    const openAfter   = document.getElementById('openAfter');

    /** In-memory queue of File objects */
    let queue = [];

    // Accessibility: pressing Enter on dropzone triggers file input
    dropzone.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault(); fileInput.click();
      }
    });

    // Choose files handler
    fileInput.addEventListener('change', (e) => {
      addFiles([...e.target.files]);
      fileInput.value = ''; // reset so selecting same files again re-triggers
    });

    // Drag-and-drop handling
    ;['dragenter','dragover'].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.add('dragover');
      });
    });
    ;['dragleave','drop'].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.remove('dragover');
      });
    });
    dropzone.addEventListener('drop', (e) => {
      const files = [...e.dataTransfer.files];
      addFiles(files);
    });

    clearBtn.addEventListener('click', () => {
      queue = []; renderList();
    });

    convertBtn.addEventListener('click', async () => {
      if (queue.length === 0) {
        toast('No files to convert.', 'warn');
        return;
      }
      for (let i = 0; i < queue.length; i++) {
        await convertOne(queue[i], i);
      }
    });

    function addFiles(files) {
      const xlsOnly = files.filter(f => /\.xls$/i.test(f.name) && !/\.xlsx$/i.test(f.name));
      const rejected = files.filter(f => !xlsOnly.includes(f));
      if (rejected.length) toast(`${rejected.length} file(s) ignored (not .xls).`, 'warn');
      if (xlsOnly.length === 0) return;

      // Avoid duplicates by name + size
      const before = queue.length;
      xlsOnly.forEach(f => {
        if (!queue.some(q => q.name === f.name && q.size === f.size)) queue.push(f);
      });
      const added = queue.length - before;
      if (added) toast(`Added ${added} file(s).`, 'ok');
      renderList();
    }

    function renderList() {
      fileListEl.innerHTML = '';
      if (queue.length === 0) {
        fileListEl.innerHTML = `<div class="item"><div class="name small">No files selected yet.</div></div>`;
        return;
      }
      queue.forEach((f, i) => {
        const row = document.createElement('div'); row.className = 'item';
        const name = document.createElement('div'); name.className = 'name'; name.textContent = f.name;
        const size = document.createElement('div'); size.className = 'small'; size.textContent = humanSize(f.size);
        const perFileBtn = document.createElement('button'); perFileBtn.className = 'btn';
        perFileBtn.textContent = 'Convert';
        perFileBtn.addEventListener('click', () => convertOne(f, i));
        row.appendChild(name); row.appendChild(size); row.appendChild(perFileBtn);
        fileListEl.appendChild(row);
      });
    }

    function humanSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      const units = ['KB','MB','GB','TB'];
      let i = -1; do { bytes = bytes / 1024; i++; } while (bytes >= 1024 && i < units.length-1);
      return bytes.toFixed(2) + ' ' + units[i];
    }

    async function convertOne(file, index) {
      try {
        const row = fileListEl.children[index];
        markRow(row, 'Converting‚Ä¶', 'warn');

        const ab = await file.arrayBuffer(); // robust for both .xls and .xlsx reading
        const wb = XLSX.read(ab, { type: 'array' });

        // Write new XLSX as ArrayBuffer
        const out = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });

        // Determine name
        const base = file.name.replace(/\.xls$/i, '');
        const outName = keepNames.checked ? `${base}.xlsx` : `${base}_converted_${timeStamp()}.xlsx`;

        // Download
        downloadBlob(new Blob([out], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" }), outName);

        // Try open after download (may be blocked by browser)
        if (openAfter.checked) {
          const url = URL.createObjectURL(new Blob([out]));
          window.open(url, "_blank");
          setTimeout(() => URL.revokeObjectURL(url), 30000);
        }

        markRow(row, 'Done', 'ok');
      } catch (err) {
        console.error(err);
        const row = fileListEl.children[index];
        markRow(row, 'Failed', 'err');
        toast(`Failed to convert: ${file.name}`, 'err');
      }
    }

    function markRow(row, text, cls) {
      // remove old badge if exists
      const old = row.querySelector('.badge'); if (old) old.remove();
      const b = document.createElement('span'); b.className = 'badge ' + cls; b.textContent = text;
      row.appendChild(b);
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 2000);
    }

    function timeStamp() {
      const d = new Date();
      const pad = (n) => String(n).padStart(2,'0');
      return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}_${pad(d.getHours())}${pad(d.getMinutes())}${pad(d.getSeconds())}`;
    }

    // Tiny toast
    let toastTimer;
    function toast(msg, level='ok'){
      clearTimeout(toastTimer);
      let t = document.getElementById('toast');
      if (!t){
        t = document.createElement('div'); t.id = 'toast';
        t.style.position='fixed'; t.style.left='50%'; t.style.bottom='26px'; t.style.transform='translateX(-50%)';
        t.style.padding='10px 14px'; t.style.borderRadius='12px';
        t.style.border='1px solid rgba(255,255,255,.14)'; t.style.zIndex='9999';
        t.style.boxShadow='0 12px 30px rgba(0,0,0,.35)';
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.background = level==='ok' ? 'rgba(16,185,129,.18)'
                         : level==='warn' ? 'rgba(245,158,11,.18)'
                         : 'rgba(239,68,68,.18)';
      t.style.color = '#e9faff';
      t.style.display='block';
      toastTimer = setTimeout(()=>{ t.style.display='none'; }, 2200);
    }
  </script>
</body>
</html>
